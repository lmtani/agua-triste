- name: Teste do workflow para detecção de covid
  command: miniwdl run -i tests/inputs.json detectar-covid.wdl
  files:
    - path: "_LAST/outputs.json"
      contains:
        - '.coverage": 0.388'
        - '.covid_presence": true'
    - path: "_LAST/out/consensus_fasta/artic_result.consensus.fasta"
      md5sum: 40ee1a0185e194efb658438920389a04

- name: Teste da tarefa ArticGuppyplex. Checa se o FASTQ gerado bate com o esperado.
  command: miniwdl run --task ArticGuppyplex -i tests/guppyplex.inputs.json detectar-covid.wdl ; \
           cat _LAST/out/fastq/guppyplexed.fastq.gz | gunzip | sort > _LAST/out/fastq/guppyplexed.sorted
  files:
    - path: "_LAST/out/fastq/guppyplexed.sorted"
      md5sum: 978909b0be89786a422208189b0dce4e

- name: Teste da tarefa ArticMinion. Checa se o consensus.FASTA gerado bate com o esperado.
  command: miniwdl run --task ArticMinion -i tests/minion.inputs.json detectar-covid.wdl
  files:
    - path: "_LAST/out/consensus_fasta/artic_result.consensus.fasta"
      md5sum: 40ee1a0185e194efb658438920389a04

- name: Teste da tarefa GetCoverage. Checa se o consensus.FASTA gerado bate com o esperado.
  command: miniwdl run --task GetCoverage -i tests/getcoverage.inputs.json detectar-covid.wdl
  files:
    - path: "_LAST/outputs.json"
      contains:
        - '.coverage": 0.388'
        - '.covid_presence": true'
